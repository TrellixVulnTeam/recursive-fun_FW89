import marshmallow as ma
from stallion.schemas.base import StrictSchema
from stallion.components.base import BaseComponent
from stallion_etsy_plugin.shared_schemas import DataprocSchema, JarsSchema

class AdhocSchema(StrictSchema):
    dataproc = ma.fields.Nested(DataprocSchema, required = True)
    jars = ma.fields.Nested(JarsSchema, required=True)
    adhoc_jar_bucket = ma.fields.String()
    gateway_host = ma.fields.URL(required = True)
    gcp_copy_cluster = ma.fields.String(required = False)
    reference_data_bucket = ma.fields.String(required = False)

    spark_environment_settings = ma.fields.Dict(required=False)

class Adhoc(BaseComponent):
    type = 'adhoc'
    schema = AdhocSchema
    allowed_deployment_types = frozenset([ 'noop' ])
