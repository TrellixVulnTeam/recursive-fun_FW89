import marshmallow as ma
from stallion.deploy.kubernetes import GKEHelmDeployer
from stallion.schemas.base import StrictSchema
from stallion.components.base import BaseCodeDeployComponent


class GenericKubernetesServiceSchema(StrictSchema):
    code_repo = ma.fields.String(required=True)
    git_tag_name = ma.fields.String(required=True)
    git_tag_version_separator = ma.fields.String(required=True)

    image_uri_base = ma.fields.String(required=True)


class GenericKubernetesService(BaseCodeDeployComponent):
    type = 'kubernetes'
    schema = None
    allowed_deployment_types = frozenset([ GKEHelmDeployer.type ])

    settings_schema_cls = GenericKubernetesServiceSchema

    @property
    def code_repo(self):
        return self.settings['code_repo']

    @property
    def git_tag_name(self):
        return self.settings['git_tag_name']

    @property
    def git_tag_version_separator(self):
        return self.settings['git_tag_version_separator']
