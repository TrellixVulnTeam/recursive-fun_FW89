from stallion.schemas.base import StrictSchema
from stallion.components.base import BaseCodeDeployComponent
from stallion_etsy_plugin.components.base import BaseServiceSchema
from stallion_etsy_plugin.shared_schemas import DataprocSchema, JarsSchema

import marshmallow as ma

class SnapshotSchema(StrictSchema):
    bucket = ma.fields.String(required=True)

class MinioSchema(StrictSchema):
    ip = ma.fields.String(required=True)

class GatewaySchema(BaseServiceSchema):
    dataproc = ma.fields.Nested(DataprocSchema) #TODO: change this to required=True
    jars = ma.fields.Nested(JarsSchema)
    snapshot = ma.fields.Nested(SnapshotSchema)
    minio = ma.fields.Nested(MinioSchema)
    prod_vertica_sink_users = ma.fields.List(ma.fields.String(), missing = [])
    override_jar = ma.fields.Str() #Provide a specific Jar to gateway

class Gateway(BaseCodeDeployComponent):
    type = 'gateway'
    schema = GatewaySchema
    allowed_deployment_types = frozenset([ 'gce' ])
